# Start the ollma server in the cluster
start-ollama:
  ssh -f $REMOTE_SERVER_SSH_LOGIN "tmux new-session -d -s ollama_main '$OLLAMA_ENV_VARS OLLAMA_HOST=127.0.0.1:$REMOTE_OLLAMA_PORT $OLLAMA_PATH_IN_REMOTE_SERVER serve'; tmux new-session -d -s ollama_llm '$OLLAMA_PATH_IN_REMOTE_SERVER run gemma3:27b'; tmux new-session -d -s ollama_vision '$OLLAMA_PATH_IN_REMOTE_SERVER run granite3.2-vision:latest'"
  @echo "Requested to start the ollama server"

# Stop the ollma server in the cluster
stop-ollama:
  ssh -f $REMOTE_SERVER_SSH_LOGIN "tmux send-keys -t ollama_llm '\/bye' C-m && tmux send-keys -t ollama_vision '\/bye' C-m && tmux send-keys -t ollama_main C-c;"
  @echo "Requested to stop the ollama server"

# Connect to the ollam server through a ssh tunnel toward the cluster
connect_remote_llm:
  @echo "You can now fetch your llm from http://localhost:$LOCAL_LLM_PORT"
  ssh -N $REMOTE_SERVER_SSH_LOGIN -L $LOCAL_LLM_PORT:localhost:$REMOTE_OLLAMA_PORT
